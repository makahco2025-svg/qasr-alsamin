<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://www2.0zz0.com/2025/10/23/00/501267947.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>قصر السمين - أكلة بلدى ... لأهل بلدى</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
        }
        /* Simple scrollbar styling for webkit browsers */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        /* Animation for modal */
        @keyframes slideIn {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .animate-slideIn {
            animation: slideIn 0.3s ease-out forwards;
        }
        .text-shadow-lg {
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        /* Loading screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff5f0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #d97634;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: #e53e3e;
            text-align: center;
            padding: 20px;
            margin: 20px;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            background-color: #fff5f5;
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .hero-title {
                font-size: 2rem;
            }
            .hero-subtitle {
                font-size: 1rem;
            }
            .category-btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
            .product-card {
                margin-bottom: 1.5rem;
            }
        }
        @media (min-width: 768px) {
            .modal-content {
                max-height: 90vh;
            }
        }
        /* Address link styling */
        .address-link {
            cursor: pointer;
            transition: color 0.2s;
        }
        .address-link:hover {
            color: #ffcc00;
        }
        /* Social media hover effects */
        .social-link {
            transition: all 0.3s ease;
        }
        .social-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        /* WhatsApp button styling */
        .whatsapp-btn {
            background-color: #25D366;
            transition: all 0.3s ease;
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }
        /* Success animation */
        @keyframes success-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .success-animation {
            animation: success-pulse 0.5s ease;
        }
        /* Map container styling */
        .map-container {
            height: 200px;
            background-color: #f1f1f1;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .map-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }
        /* Form validation styling */
        .input-error {
            border-color: #e53e3e !important;
        }
        .error-text {
            color: #e53e3e;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        /* Location picker styling */
        .location-picker {
            position: relative;
        }
        .location-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #d97634;
            color: white;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 0.75rem;
            cursor: pointer;
            z-index: 10;
        }
        /* Step indicator styling */
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        .step {
            display: flex;
            align-items: center;
        }
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
        .step.active .step-number {
            background-color: #d97634;
            color: white;
        }
        .step-line {
            width: 60px;
            height: 2px;
            background-color: #e5e7eb;
            margin: 0 8px;
        }
        .step.active .step-line {
            background-color: #d97634;
        }
    </style>
</head>
<body class="bg-[#fff5f0]">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p class="text-xl text-[#3e2723]">جاري تحميل قصر السمين...</p>
    </div>

    <!-- Error Message (initially hidden) -->
    <div id="error-message" class="error-message" style="display: none;">
        <h2 class="text-2xl font-bold mb-2">حدث خطأ في تحميل الموقع</h2>
        <p id="error-details">يرجى التحقق من اتصالك بالإنترنت أو المحاولة مرة أخرى لاحقًا.</p>
        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-[#d97634] text-white rounded hover:bg-[#8b4513]">
            إعادة تحميل الصفحة
        </button>
    </div>

    <!-- Main App Container -->
    <div id="root" style="display: none;">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-40">
            <div class="bg-[#3e2723] text-white py-2 text-sm">
                <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-2">
                    <div class="flex gap-4">
                        <a href="tel:01118091234" class="hover:text-[#ffcc00] transition-colors"><i class="fas fa-phone ml-1"></i> 01118091234</a>
                        <a href="mailto:fajr.adv.2013@gmail.com" class="hover:text-[#ffcc00] transition-colors"><i class="fas fa-envelope ml-1"></i> fajr.adv.2013@gmail.com</a>
                    </div>
                    <div class="flex gap-4">
                        <a href="#" class="hover:text-[#ffcc00] transition-colors"><i class="fas fa-clock ml-1"></i> 10:00 ص - 01:00 ص</a>
                    </div>
                </div>
            </div>
            <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-4">
                    <img src="https://www2.0zz0.com/2025/10/23/00/501267947.png" alt="شعار قصر السمين" class="h-16 transition-transform hover:scale-105" />
                    <div>
                        <h1 class="text-3xl font-bold text-[#3e2723]">قصر السمين</h1>
                        <p class="text-sm text-[#d97634]">أكلة بلدى ... لأهل بلدى</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <a href="https://wa.me/201030566078" target="_blank" rel="noopener noreferrer" class="social-link w-11 h-11 rounded-full bg-[#d97634] text-white flex items-center justify-center text-xl transition-all hover:bg-[#8b4513] hover:-translate-y-1">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.facebook.com/share/1BpyFS6dCq/" target="_blank" rel="noopener noreferrer" class="social-link w-11 h-11 rounded-full bg-[#d97634] text-white flex items-center justify-center text-xl transition-all hover:bg-[#8b4513] hover:-translate-y-1">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <button onclick="toggleCartModal()" class="relative w-11 h-11 rounded-full bg-[#d97634] text-white flex items-center justify-center text-xl transition-all hover:bg-[#8b4513] hover:-translate-y-1" aria-label="Open delivery cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-[#ffcc00] text-[#3e2723] rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold" style="display: none;">0</span>
                    </button>
                    <button onclick="toggleDineInModal()" class="relative w-11 h-11 rounded-full bg-[#d97634] text-white flex items-center justify-center text-xl transition-all hover:bg-[#8b4513] hover:-translate-y-1" aria-label="Open dine-in order">
                        <i class="fas fa-utensils"></i>
                        <span id="dinein-count" class="absolute -top-1 -right-1 bg-[#ffcc00] text-[#3e2723] rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold" style="display: none;">0</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="relative h-96">
            <img src="https://www2.0zz0.com/2025/10/22/23/773808599.jpg" alt="قصر السمين" class="w-full h-full object-cover" />
            <div class="absolute inset-0 bg-black/50 flex items-center justify-center text-white text-center">
                <div class="max-w-3xl px-4">
                    <h1 class="hero-title text-4xl md:text-5xl font-extrabold mb-4 text-shadow-lg">قصر السمين</h1>
                    <p class="hero-subtitle text-lg md:text-xl mb-6">أكلة بلدى ... لأهل بلدى</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="scrollToMenu()" class="py-3 px-6 rounded-full font-semibold bg-[#d97634] text-white transition-all hover:bg-[#8b4513] hover:-translate-y-1 flex items-center justify-center gap-2">
                            <i class="fas fa-utensils"></i> استعرض القائمة
                        </button>
                        <a href="tel:01030566078" class="py-3 px-6 rounded-full font-semibold bg-transparent border-2 border-white text-white transition-colors hover:bg-white hover:text-[#3e2723] flex items-center justify-center gap-2">
                            <i class="fas fa-phone"></i> اطلب الآن
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Search Bar -->
        <section class="bg-white shadow-sm py-8 relative -mt-12 z-30 mx-4 rounded-lg md:mx-auto">
            <div class="container mx-auto px-4">
                <div class="relative max-w-2xl mx-auto">
                    <input
                        type="text"
                        id="search-input"
                        onkeyup="handleSearch(event)"
                        class="w-full py-4 pr-12 pl-8 border-2 border-gray-200 rounded-full text-base transition-all shadow-inner focus:outline-none focus:border-[#d97634] focus:ring-2 focus:ring-[#d97634]/30"
                        placeholder="ابحث عن وجبتك المفضلة..."
                    />
                    <button onclick="performSearch()" class="absolute top-1/2 -translate-y-1/2 right-3 bg-[#d97634] text-white w-10 h-10 rounded-full flex items-center justify-center transition-colors hover:bg-[#8b4513]" aria-label="Search">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Category Navigation -->
        <nav class="bg-[#3e2723] sticky top-[220px] md:top-[132px] z-20 shadow-lg">
            <div class="container mx-auto px-4">
                <ul class="flex items-center justify-center overflow-x-auto scrollbar-hide whitespace-nowrap">
                    <li>
                        <button onclick="filterByCategory('all')" class="category-btn py-4 px-6 text-white font-medium transition-colors relative hover:bg-white/10 text-[#ffcc00]" data-category="all">
                            الكل
                            <span class="absolute bottom-0 left-0 w-full h-1 bg-[#ffcc00]"></span>
                        </button>
                    </li>
                    <li>
                        <button onclick="filterByCategory(1)" class="category-btn py-4 px-6 text-white font-medium transition-colors relative hover:bg-white/10" data-category="1">
                            <i class="fas fa-fire ml-2"></i>مشويات
                        </button>
                    </li>
                    <li>
                        <button onclick="filterByCategory(2)" class="category-btn py-4 px-6 text-white font-medium transition-colors relative hover:bg-white/10" data-category="2">
                            <i class="fas fa-utensils ml-2"></i>أطباق رئيسية
                        </button>
                    </li>
                    <li>
                        <button onclick="filterByCategory(3)" class="category-btn py-4 px-6 text-white font-medium transition-colors relative hover:bg-white/10" data-category="3">
                            <i class="fas fa-hamburger ml-2"></i>سندوتشات
                        </button>
                    </li>
                    <li>
                        <button onclick="filterByCategory(4)" class="category-btn py-4 px-6 text-white font-medium transition-colors relative hover:bg-white/10" data-category="4">
                            <i class="fas fa-cheese ml-2"></i>مقبلات
                        </button>
                    </li>
                    <li>
                        <button onclick="filterByCategory(5)" class="category-btn py-4 px-6 text-white font-medium transition-colors relative hover:bg-white/10" data-category="5">
                            <i class="fas fa-leaf ml-2"></i>مشروبات
                        </button>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Slider -->
        <section class="py-12 bg-white">
            <div class="container mx-auto px-4">
                <div class="relative rounded-2xl overflow-hidden shadow-xl h-80">
                    <div id="slide-1" class="slide absolute inset-0 transition-opacity duration-1000 opacity-100">
                        <img src="https://www2.0zz0.com/2025/10/23/00/698406669.jpg" alt="عرض خاص على المشويات" class="w-full h-full object-cover" />
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-0 right-0 p-8 text-white">
                            <h3 class="text-3xl font-bold mb-2">عرض خاص على المشويات</h3>
                            <p class="text-2xl font-semibold text-[#ffcc00]">خصم 20%</p>
                        </div>
                    </div>
                    <div id="slide-2" class="slide absolute inset-0 transition-opacity duration-1000 opacity-0">
                        <img src="https://www2.0zz0.com/2025/10/23/00/693659791.jpg" alt="وجبة عائلية متنوعة" class="w-full h-full object-cover" />
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-0 right-0 p-8 text-white">
                            <h3 class="text-3xl font-bold mb-2">وجبة عائلية متنوعة</h3>
                            <p class="text-2xl font-semibold text-[#ffcc00]">250 جنيه فقط</p>
                        </div>
                    </div>
                    <div id="slide-3" class="slide absolute inset-0 transition-opacity duration-1000 opacity-0">
                        <img src="https://www2.0zz0.com/2025/10/23/00/864068347.jpg" alt="توصيل مجاني للطلبات فوق 200 جنيه" class="w-full h-full object-cover" />
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-0 right-0 p-8 text-white">
                            <h3 class="text-3xl font-bold mb-2">توصيل مجاني للطلبات فوق 200 جنيه</h3>
                        </div>
                    </div>
                    <div class="absolute top-1/2 -translate-y-1/2 w-full flex justify-between px-4">
                        <button onclick="changeSlide(-1)" class="w-12 h-12 bg-white/70 rounded-full text-[#3e2723] text-lg transition-colors hover:bg-white" aria-label="Previous slide"><i class="fas fa-chevron-right"></i></button>
                        <button onclick="changeSlide(1)" class="w-12 h-12 bg-white/70 rounded-full text-[#3e2723] text-lg transition-colors hover:bg-white" aria-label="Next slide"><i class="fas fa-chevron-left"></i></button>
                    </div>
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                        <button onclick="goToSlide(1)" class="slide-dot w-3 h-3 rounded-full transition-colors bg-white" data-slide="1"></button>
                        <button onclick="goToSlide(2)" class="slide-dot w-3 h-3 rounded-full transition-colors bg-white/50" data-slide="2"></button>
                        <button onclick="goToSlide(3)" class="slide-dot w-3 h-3 rounded-full transition-colors bg-white/50" data-slide="3"></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Menu Section -->
        <main id="menu-section" class="py-12">
            <div class="container mx-auto px-4">
                <div id="menu-categories">
                    <!-- Categories will be dynamically inserted here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-[#3e2723] text-white pt-12 pb-6">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                    <div>
                        <h3 class="text-xl font-bold text-[#ffcc00] mb-4">تواصل معنا</h3>
                        <p class="mb-2"><i class="fas fa-phone ml-1"></i> هاتف: 01118091234</p>
                        <p class="mb-2"><i class="fas fa-phone ml-1"></i> دليفري: 01030566078</p>
                        <p class="mb-4"><i class="fas fa-envelope ml-1"></i> بريد: fajr.adv.2013@gmail.com</p>
                        <div class="flex gap-4">
                             <a href="https://wa.me/201030566078" target="_blank" rel="noopener noreferrer" class="social-link w-10 h-10 bg-white/10 rounded-full flex items-center justify-center transition-all hover:bg-[#d97634] hover:-translate-y-1"><i class="fab fa-whatsapp"></i></a>
                             <a href="https://www.facebook.com/share/1BpyFS6dCq/" target="_blank" rel="noopener noreferrer" class="social-link w-10 h-10 bg-white/10 rounded-full flex items-center justify-center transition-all hover:bg-[#d97634] hover:-translate-y-1"><i class="fab fa-facebook-f"></i></a>
                             <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" class="social-link w-10 h-10 bg-white/10 rounded-full flex items-center justify-center transition-all hover:bg-[#d97634] hover:-translate-y-1"><i class="fab fa-twitter"></i></a>
                             <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" class="social-link w-10 h-10 bg-white/10 rounded-full flex items-center justify-center transition-all hover:bg-[#d97634] hover:-translate-y-1"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-[#ffcc00] mb-4">معلومات المطعم</h3>
                        <p class="mb-2 address-link" onclick="openMap()"><i class="fas fa-map-marker-alt ml-1"></i> العنوان: 1 شارع احمد عرابى - امام موقف أمباية - شبرا الخيمة</p>
                        <p><i class="fas fa-clock ml-1"></i> مواعيد العمل: 10:00 ص - 01:00 ص</p>
                    </div>
                     <div>
                        <h3 class="text-xl font-bold text-[#ffcc00] mb-4">روابط سريعة</h3>
                        <ul>
                            <li class="mb-2"><a href="#" onclick="scrollToCategory(1)" class="hover:text-[#ffcc00] transition-colors">مشويات</a></li>
                            <li class="mb-2"><a href="#" onclick="scrollToCategory(2)" class="hover:text-[#ffcc00] transition-colors">أطباق رئيسية</a></li>
                            <li class="mb-2"><a href="#" onclick="scrollToCategory(3)" class="hover:text-[#ffcc00] transition-colors">سندوتشات</a></li>
                            <li class="mb-2"><a href="#" onclick="scrollToCategory(4)" class="hover:text-[#ffcc00] transition-colors">مقبلات</a></li>
                            <li class="mb-2"><a href="#" onclick="scrollToCategory(5)" class="hover:text-[#ffcc00] transition-colors">مشروبات</a></li>
                        </ul>
                    </div>
                </div>
                <div class="text-center pt-6 border-t border-white/10 text-sm">
                    <p>&copy; 2025 قصر السمين. جميع الحقوق محفوظة.</p>
                </div>
            </div>
        </footer>

        <!-- Cart Modal -->
        <div id="cart-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" style="display: none;" onclick="closeCartModalOnBackground(event)">
            <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-full md:h-auto md:max-h-[90vh] animate-slideIn overflow-hidden flex flex-col" onclick="event.stopPropagation()">
                <header class="bg-[#3e2723] text-white p-5 flex justify-between items-center flex-shrink-0">
                    <h3 class="text-xl font-bold">سلة التوصيل</h3>
                    <button onclick="toggleCartModal()" class="text-2xl">&times;</button>
                </header>
                <div class="p-6 overflow-y-auto flex-1">
                    <p id="cart-empty" class="text-center text-gray-500 py-10">السلة فارغة</p>
                    <div id="cart-items" style="display: none;">
                        <!-- Cart items will be dynamically inserted here -->
                    </div>
                </div>
                <div id="cart-summary" class="p-6 bg-gray-50 flex-shrink-0" style="display: none;">
                    <div class="flex justify-between items-center text-xl font-bold">
                        <span>الإجمالي:</span>
                        <span id="cart-total" class="text-[#d97634]">0 جنيه</span>
                    </div>
                </div>
                <footer id="cart-footer" class="p-5 bg-gray-100 flex flex-col sm:flex-row gap-3 flex-shrink-0" style="display: none;">
                    <button onclick="clearCart()" class="py-3 px-5 rounded-lg bg-red-600 text-white font-bold transition-colors hover:bg-red-700">إفراغ السلة</button>
                    <button onclick="openCustomerInfoModal()" class="flex-1 py-3 px-5 rounded-lg whatsapp-btn text-white font-bold transition-all flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp"></i> إرسال للواتساب
                    </button>
                </footer>
            </div>
        </div>

        <!-- Dine In Modal -->
        <div id="dinein-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" style="display: none;" onclick="closeDineInModalOnBackground(event)">
            <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-full md:h-auto md:max-h-[90vh] animate-slideIn overflow-hidden flex flex-col" onclick="event.stopPropagation()">
                <header class="bg-[#ffcc00] text-[#3e2723] p-5 flex justify-between items-center flex-shrink-0">
                    <h3 class="text-xl font-bold">طلب داخل المطعم</h3>
                    <button onclick="toggleDineInModal()" class="text-2xl">&times;</button>
                </header>
                <div class="p-6 overflow-y-auto flex-1">
                    <p id="dinein-empty" class="text-center text-gray-500 py-10">لا توجد طلبات بعد</p>
                    <div id="dinein-items" style="display: none;">
                        <!-- Dine in items will be dynamically inserted here -->
                    </div>
                    <form id="dinein-form" class="mt-6 border-t pt-6" style="display: none;">
                        <div class="space-y-4">
                            <div>
                                <label for="dineInCustomerName" class="block text-sm font-medium text-gray-700 mb-1">اسم العميل</label>
                                <input type="text" id="dineInCustomerName" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#ffcc00] focus:border-[#ffcc00]"/>
                            </div>
                            <div>
                                <label for="tableNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم الترابيزة</label>
                                <input type="text" id="tableNumber" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#ffcc00] focus:border-[#ffcc00]"/>
                            </div>
                             <div>
                                <label for="dineInOrderNotes" class="block text-sm font-medium text-gray-700 mb-1">ملاحظات إضافية (اختياري)</label>
                                <textarea id="dineInOrderNotes" rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#ffcc00] focus:border-[#ffcc00]"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <footer id="dinein-footer" class="p-5 bg-gray-100 flex-shrink-0" style="display: none;">
                    <button onclick="sendDineInToWhatsApp()" class="w-full py-3 px-5 rounded-lg whatsapp-btn text-white font-bold transition-all flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp"></i> إرسال للواتساب
                    </button>
                </footer>
            </div>
        </div>

        <!-- Customer Info Modal -->
        <div id="customer-info-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" style="display: none;" onclick="closeCustomerInfoModalOnBackground(event)">
            <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-full md:h-auto md:max-h-[90vh] animate-slideIn overflow-hidden flex flex-col" onclick="event.stopPropagation()">
                <header class="bg-[#3e2723] text-white p-5 flex justify-between items-center flex-shrink-0">
                    <h3 class="text-xl font-bold">معلومات التوصيل</h3>
                    <button onclick="toggleCustomerInfoModal()" class="text-2xl">&times;</button>
                </header>
                
                <!-- Step Indicator -->
                <div class="step-indicator p-4">
                    <div class="step active">
                        <div class="step-number">1</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                    </div>
                </div>
                
                <div class="p-6 overflow-y-auto flex-1">
                    <form id="customer-info-form" class="space-y-4">
                        <!-- Personal Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-lg font-semibold mb-4 text-[#3e2723]">معلومات شخصية</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">الاسم الكامل</label>
                                    <input type="text" id="customerName" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                    <span id="customerName-error" class="error-text"></span>
                                </div>
                                <div>
                                    <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-1">رقم الموبايل</label>
                                    <input type="tel" id="customerPhone" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                    <span id="customerPhone-error" class="error-text"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Address Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-lg font-semibold mb-4 text-[#3e2723]">معلومات العنوان</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="city" class="block text-sm font-medium text-gray-700 mb-1">المدينة</label>
                                    <input type="text" id="city" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                    <span id="city-error" class="error-text"></span>
                                </div>
                                <div>
                                    <label for="district" class="block text-sm font-medium text-gray-700 mb-1">المنطقة/الحي</label>
                                    <input type="text" id="district" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                    <span id="district-error" class="error-text"></span>
                                </div>
                                <div>
                                    <label for="street" class="block text-sm font-medium text-gray-700 mb-1">اسم الشارع</label>
                                    <input type="text" id="street" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                    <span id="street-error" class="error-text"></span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                <div>
                                    <label for="buildingNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم المبنى</label>
                                    <input type="text" id="buildingNumber" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                    <span id="buildingNumber-error" class="error-text"></span>
                                </div>
                                <div>
                                    <label for="apartmentNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم الشقة</label>
                                    <input type="text" id="apartmentNumber" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                </div>
                                <div>
                                    <label for="floorNumber" class="block text-sm font-medium text-gray-700 mb-1">الدور/الطابق</label>
                                    <input type="text" id="floorNumber" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]"/>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Location Information -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-lg font-semibold mb-4 text-[#3e2723]">الموقع الجغرافي</h4>
                            <div class="mb-4">
                                <label for="locationNotes" class="block text-sm font-medium text-gray-700 mb-1">علامة مميزة (اختياري)</label>
                                <input type="text" id="locationNotes" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]" placeholder="مثال: بجانب البنك، أمام المحل التجاري"/>
                            </div>
                            <div class="map-container">
                                <div id="map-placeholder" class="map-placeholder">
                                    <i class="fas fa-map-marked-alt text-3xl mb-2"></i>
                                    <p>سيتم تحديد موقعك تلقائياً</p>
                                </div>
                                <button type="button" onclick="getCurrentLocation()" class="location-btn absolute top-2 right-2 bg-[#d97634] text-white px-3 py-1 rounded text-sm">
                                    <i class="fas fa-location-arrow ml-1"></i> تحديد موقعي
                                </button>
                            </div>
                            <input type="hidden" id="latitude" />
                            <input type="hidden" id="longitude" />
                            <input type="hidden" id="locationUrl" />
                        </div>
                        
                        <!-- Order Notes -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-lg font-semibold mb-4 text-[#3e2723]">ملاحظات الطلب</h4>
                            <textarea id="orderNotes" rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#d97634] focus:border-[#d97634]" placeholder="أي ملاحظات خاصة بطلبك"></textarea>
                        </div>
                    </form>
                </div>
                <footer class="p-5 bg-gray-100 flex flex-col sm:flex-row gap-3 flex-shrink-0">
                    <button onclick="toggleCustomerInfoModal()" class="py-3 px-5 rounded-lg bg-gray-300 text-gray-700 font-bold transition-colors hover:bg-gray-400">إلغاء</button>
                    <button onclick="validateAndSendOrder()" class="flex-1 py-3 px-5 rounded-lg whatsapp-btn text-white font-bold transition-all flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp"></i> إرسال الطلب
                    </button>
                </footer>
            </div>
        </div>

        <!-- Size Modal -->
        <div id="size-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" style="display: none;" onclick="closeSizeModalOnBackground(event)">
            <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-xl animate-slideIn overflow-hidden flex flex-col" onclick="event.stopPropagation()">
                <header class="bg-[#d97634] text-white p-5 flex justify-between items-center">
                    <h3 class="text-xl font-bold">اختر الحجم</h3>
                    <button onclick="toggleSizeModal()" class="text-2xl">&times;</button>
                </header>
                <div class="p-6">
                    <img id="size-modal-image" src="" alt="" class="w-full h-52 object-cover rounded-lg mb-6"/>
                    <h3 id="size-modal-title" class="text-xl font-bold mb-4"></h3>
                    <div id="size-options" class="flex flex-col gap-3">
                        <!-- Size options will be dynamically inserted here -->
                    </div>
                </div>
                <footer class="p-5 bg-gray-50 flex flex-col sm:flex-row gap-3">
                    <button id="add-to-cart-size" onclick="addToCartWithSize()" disabled class="flex-1 py-3 px-5 rounded-lg bg-[#d97634] text-white font-bold transition-colors hover:bg-[#8b4513] disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                        <i class="fas fa-shopping-cart"></i> إضافة للسلة
                    </button>
                     <button id="add-to-dinein-size" onclick="addToDineInWithSize()" disabled class="flex-1 py-3 px-5 rounded-lg bg-[#ffcc00] text-[#3e2723] font-bold transition-colors hover:bg-[#e6b800] disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                        <i class="fas fa-utensils"></i> طلب في المطعم
                    </button>
                </footer>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-[#3e2723] text-white py-3 px-6 rounded-lg shadow-lg z-[60]" style="display: none;">
            <span id="toast-message"></span>
        </div>

        <!-- Scroll to Top Button -->
        <button id="scroll-to-top" onclick="scrollToTop()" class="fixed bottom-5 right-5 w-12 h-12 bg-[#d97634] text-white rounded-full flex items-center justify-center shadow-lg transition-transform hover:scale-110 focus:outline-none z-40" style="display: none;" aria-label="Scroll to top">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <script>
        // Data
        const restaurantData = {
            categories: [
                { id: 1, name: "مشويات", icon: "fa-fire" },
                { id: 2, name: "أطباق رئيسية", icon: "fa-utensils" },
                { id: 3, name: "سندوتشات", icon: "fa-hamburger" },
                { id: 4, name: "مقبلات", icon: "fa-cheese" },
                { id: 5, name: "مشروبات", icon: "fa-leaf" },
            ],
            products: [
                { id: 1, categoryId: 1, name: "طلب مشكل عادى", description: "لحم ضأن ممتاز مشوي على الفحم مع التوابل الشرقية الأصيلة", image: "https://www2.0zz0.com/2025/10/22/23/323379983.jpg", hasSizes: false, price: 110 },
                { id: 2, categoryId: 1, name: "طلب مشكل ملك السمين", description: "دجاج منقوع بالزبادي والتوابل ومشوي على الفحم", image: "https://www2.0zz0.com/2025/10/22/23/852803087.jpg", hasSizes: false, price: 130 },
                { id: 3, categoryId: 1, name: "طلب مشكل ربع عادى", description: "كفتة لحم ضأن بالبقدونس والبصل والتوابل المشكلة", image: "https://www2.0zz0.com/2025/10/22/23/592752516.jpeg", hasSizes: false, price: 160 },
                { id: 4, categoryId: 2, name: "طلب مشكل قصر السمين", description: "لحم ضأن مطهو على الطور التقليدي بالبهارات العربية", image: "https://www2.0zz0.com/2025/10/22/23/592752516.jpeg", hasSizes: false, price: 220 },
                { id: 5, categoryId: 2, name: "طلب نصف مشكل فاخر", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/592752516.jpeg", hasSizes: false, price: 320 },
                { id: 6, categoryId: 2, name: "ربع كفتة بلدى على الفحم", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/877383500.jpeg", hasSizes: false, price: 100 },
                { id: 7, categoryId: 2, name: "ربع لحمة محمرة بلدى باللية", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/592236985.jpeg", hasSizes: false, price: 200 },
                { id: 8, categoryId: 2, name: "ربع سجق بلدى باللية", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/765659795.jpg", hasSizes: false, price: 160 },
                { id: 9, categoryId: 2, name: "ربع كبدة باللية", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/636014350.jpeg", hasSizes: false, price: 160 },
                { id: 10, categoryId: 2, name: "ربع فشة وطحال", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/636014350.jpeg", hasSizes: false, price: 170 },
                { id: 11, categoryId: 2, name: "ربع كفتة باللية", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/636014350.jpeg", hasSizes: false, price: 160 },
                { id: 12, categoryId: 3, name: "رغيف مشكل", description: "شاورما لحم ضأن مع الخضروات والصلصات", image: "https://www2.0zz0.com/2025/10/22/23/830719429.jpeg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 70 }, { name: "كبير", price: 80 }] },
                { id: 13, categoryId: 3, name: "رغيف كبدة باللية", description: "شاورما دجاج مع الخضروات والصلصات", image: "https://www2.0zz0.com/2025/10/22/23/898201606.jpg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 70 }, { name: "كبير", price: 80 }] },
                { id: 14, categoryId: 3, name: "رغيف لحمة محمرة باللية", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/310346821.jpeg", hasSizes: false, price: 110 },
                { id: 15, categoryId: 3, name: "رغيف سجق بلدى باللية", description: "أرز بسمتي مطهو مع قطع الدجاج والتوابل العطرية", image: "https://www2.0zz0.com/2025/10/22/23/304344100.jpg", hasSizes: false, price: 60 },
                { id: 16, categoryId: 3, name: "رغيف كفتة بلدى باللية", description: "كباب لحم مع الخضروات والصلصات", image: "https://www2.0zz0.com/2025/10/22/23/948403611.jpg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 70 }] },
                { id: 17, categoryId: 3, name: "رغيف سمين بلدى باللية", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/468176074.jpeg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 70 }] },
                { id: 18, categoryId: 3, name: "رغيف طحال", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/897927229.jpg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 80 }] },
                { id: 19, categoryId: 3, name: "رغيف فشة", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/897927229.jpg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 80 }] },
                { id: 20, categoryId: 3, name: "رغيف لحمة راس", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/821958998.jpeg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 80 }, { name: "وسط", price: 100 }] },
                { id: 21, categoryId: 3, name: "رغيف ممبار", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/586718991.jpg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 60 }, { name: "وسط", price: 70 }, { name: "كبير", price: 80 }] },
                { id: 22, categoryId: 3, name: "رغيف حواوشى", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/133885767.jpeg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 50 }, { name: "وسط", price: 70 }] },
                { id: 23, categoryId: 3, name: "رغيف كغتة على الفحم", description: "فتة شاورما بالخبز المحمص والصلصة والزيت", image: "https://www2.0zz0.com/2025/10/23/00/219890455.jpg", hasSizes: true, price: 0, sizes: [{ name: "صغير", price: 50 }, { name: "وسط", price: 70 }] },
                { id: 24, categoryId: 4, name: "سلطة خضراء", description: "متبل مشوي مع صلصة الطحينة الغنية وزيت الزيتون", image: "https://www2.0zz0.com/2025/10/23/00/613769838.png", hasSizes: false, price: 10 },
                { id: 25, categoryId: 4, name: "طحينة", description: "حمص معصون بالطحينة وعصير الليمون والزيت", image: "https://www2.0zz0.com/2025/10/23/00/943591820.png", hasSizes: false, price: 15 },
                { id: 26, categoryId: 5, name: "مياة معدنية صغيرة", description: "سلطة البقدونس مع البرغل والطماطم والبصل وعصير الليمون", image: "https://www2.0zz0.com/2025/10/23/00/182906841.jpg", hasSizes: false, price: 10 },
                { id: 27, categoryId: 5, name: "مياة معدنية كبيرة", description: "سلطة الخضروات مع الخبز المحمص والرمان", image: "https://www2.0zz0.com/2025/10/23/00/937909087.jpg", hasSizes: false, price: 15 }
            ]
        };

        // State
        let cart = [];
        let dineInCart = [];
        let activeCategoryId = 'all';
        let searchTerm = '';
        let currentSlide = 1;
        let slideInterval;
        let selectedProductForSize = null;
        let selectedSize = null;

        // Initialize App with error handling
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Content Loaded. Starting initialization...");
            try {
                // A small delay to ensure everything is settled
                setTimeout(() => {
                    console.log("Attempting to render menu and start slider...");
                    renderMenu();
                    startSlider();
                    
                    console.log("Hiding loader and showing main content.");
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('root').style.display = 'block';
                }, 1500);
            } catch (error) {
                console.error("An error occurred during app initialization:", error);
                // Hide loader and show error message
                document.getElementById('loading-screen').style.display = 'none';
                const errorDiv = document.getElementById('error-message');
                const errorDetails = document.getElementById('error-details');
                errorDetails.textContent = `حدث خطأ غير متوقع: ${error.message}`;
                errorDiv.style.display = 'block';
            }
        });

        // --- SLIDER ---
        function startSlider() {
            slideInterval = setInterval(() => {
                changeSlide(1);
            }, 5000);
        }

        function changeSlide(direction) {
            clearInterval(slideInterval);
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slide-dot');
            
            slides[currentSlide - 1].style.opacity = '0';
            dots[currentSlide - 1].classList.remove('bg-white');
            dots[currentSlide - 1].classList.add('bg-white/50');

            currentSlide = (currentSlide + direction - 1 + 3) % 3 + 1;

            slides[currentSlide - 1].style.opacity = '1';
            dots[currentSlide - 1].classList.add('bg-white');
            dots[currentSlide - 1].classList.remove('bg-white/50');
            
            startSlider();
        }

        function goToSlide(slideNumber) {
            clearInterval(slideInterval);
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slide-dot');
            
            slides[currentSlide - 1].style.opacity = '0';
            dots[currentSlide - 1].classList.remove('bg-white');
            dots[currentSlide - 1].classList.add('bg-white/50');
            
            currentSlide = slideNumber;

            slides[currentSlide - 1].style.opacity = '1';
            dots[currentSlide - 1].classList.add('bg-white');
            dots[currentSlide - 1].classList.remove('bg-white/50');
            
            startSlider();
        }

        // --- MENU RENDERING & FILTERING ---
        function renderMenu() {
            const menuContainer = document.getElementById('menu-categories');
            if (!menuContainer) {
                throw new Error("Menu container element not found!");
            }
            menuContainer.innerHTML = '';

            const categoriesToRender = activeCategoryId === 'all' 
                ? restaurantData.categories 
                : restaurantData.categories.filter(cat => cat.id == activeCategoryId);

            let productsToRender = restaurantData.products;

            if (searchTerm) {
                productsToRender = productsToRender.filter(p => 
                    p.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }

            categoriesToRender.forEach(category => {
                const categoryProducts = productsToRender.filter(p => p.categoryId === category.id);
                if (categoryProducts.length === 0 && activeCategoryId !== 'all') return;

                const section = document.createElement('section');
                section.id = `category-${category.id}`;
                section.className = 'mb-12';
                
                const header = document.createElement('div');
                header.className = 'flex items-center justify-between mb-6';
                header.innerHTML = `
                    <h2 class="text-3xl font-bold text-[#3e2723] flex items-center gap-3">
                        <i class="fas ${category.icon} text-[#d97634]"></i>
                        ${category.name}
                    </h2>
                `;
                section.appendChild(header);

                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';
                
                categoryProducts.forEach(product => {
                    grid.appendChild(createProductCard(product));
                });

                section.appendChild(grid);
                menuContainer.appendChild(section);
            });
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-2xl';
            
            card.innerHTML = `
                <div class="relative">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                    <div class="absolute top-2 left-2 bg-[#ffcc00] text-[#3e2723] px-3 py-1 rounded-full text-sm font-bold">
                        ${product.hasSizes ? 'من' : ''} ${product.price} ج.م
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="text-xl font-bold text-[#3e2723] mb-2">${product.name}</h3>
                    <p class="text-gray-600 text-sm mb-4">${product.description}</p>
                    <div class="flex gap-2">
                        <button onclick="openSizeModal(${product.id})" class="flex-1 py-2 px-4 rounded-lg bg-[#d97634] text-white font-semibold transition-all hover:bg-[#8b4513] flex items-center justify-center gap-2">
                            <i class="fas fa-shopping-cart"></i> توصيل
                        </button>
                        <button onclick="openSizeModalForDineIn(${product.id})" class="flex-1 py-2 px-4 rounded-lg bg-[#ffcc00] text-[#3e2723] font-semibold transition-all hover:bg-[#e6b800] flex items-center justify-center gap-2">
                            <i class="fas fa-utensils"></i> في المطعم
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        function filterByCategory(categoryId) {
            activeCategoryId = categoryId;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('text-[#ffcc00]');
                const indicator = btn.querySelector('span');
                if (indicator) indicator.remove();
            });

            const activeBtn = document.querySelector(`[data-category="${categoryId}"]`);
            activeBtn.classList.add('text-[#ffcc00]');
            if (!activeBtn.querySelector('span')) {
                const indicator = document.createElement('span');
                indicator.className = 'absolute bottom-0 left-0 w-full h-1 bg-[#ffcc00]';
                activeBtn.appendChild(indicator);
            }
            
            renderMenu();
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            searchTerm = document.getElementById('search-input').value;
            renderMenu();
        }

        // --- CART & DINE-IN LOGIC ---
        function toggleCartModal() {
            const modal = document.getElementById('cart-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            if (modal.style.display === 'flex') {
                renderCartItems();
            }
        }

        function toggleDineInModal() {
            const modal = document.getElementById('dinein-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            if (modal.style.display === 'flex') {
                renderDineInItems();
            }
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items');
            const emptyMessage = document.getElementById('cart-empty');
            const summary = document.getElementById('cart-summary');
            const footer = document.getElementById('cart-footer');
            const countBadge = document.getElementById('cart-count');

            if (cart.length === 0) {
                container.style.display = 'none';
                emptyMessage.style.display = 'block';
                summary.style.display = 'none';
                footer.style.display = 'none';
                countBadge.style.display = 'none';
            } else {
                container.style.display = 'block';
                emptyMessage.style.display = 'none';
                summary.style.display = 'block';
                footer.style.display = 'flex';
                countBadge.style.display = 'flex';
                countBadge.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

                container.innerHTML = cart.map((item, index) => `
                    <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg mb-3">
                        <div class="flex items-center gap-3">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                            <div>
                                <h4 class="font-semibold text-[#3e2723]">${item.name} ${item.sizeName ? `(${item.sizeName})` : ''}</h4>
                                <p class="text-sm text-gray-600">${item.price} ج.م</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="updateCartQuantity(${index}, -1)" class="w-8 h-8 bg-[#d97634] text-white rounded-full flex items-center justify-center hover:bg-[#8b4513]">-</button>
                            <span class="font-semibold w-8 text-center">${item.quantity}</span>
                            <button onclick="updateCartQuantity(${index}, 1)" class="w-8 h-8 bg-[#d97634] text-white rounded-full flex items-center justify-center hover:bg-[#8b4513]">+</button>
                            <button onclick="removeFromCart(${index})" class="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 mr-2"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');

                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                document.getElementById('cart-total').textContent = `${total} جنيه`;
            }
        }

        function renderDineInItems() {
            const container = document.getElementById('dinein-items');
            const emptyMessage = document.getElementById('dinein-empty');
            const form = document.getElementById('dinein-form');
            const footer = document.getElementById('dinein-footer');
            const countBadge = document.getElementById('dinein-count');

            if (dineInCart.length === 0) {
                container.style.display = 'none';
                emptyMessage.style.display = 'block';
                form.style.display = 'none';
                footer.style.display = 'none';
                countBadge.style.display = 'none';
            } else {
                container.style.display = 'block';
                emptyMessage.style.display = 'none';
                form.style.display = 'block';
                footer.style.display = 'block';
                countBadge.style.display = 'flex';
                countBadge.textContent = dineInCart.reduce((sum, item) => sum + item.quantity, 0);

                container.innerHTML = dineInCart.map((item, index) => `
                    <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg mb-3">
                        <div class="flex items-center gap-3">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                            <div>
                                <h4 class="font-semibold text-[#3e2723]">${item.name} ${item.sizeName ? `(${item.sizeName})` : ''}</h4>
                                <p class="text-sm text-gray-600">${item.price} ج.م</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="updateDineInQuantity(${index}, -1)" class="w-8 h-8 bg-[#ffcc00] text-[#3e2723] rounded-full flex items-center justify-center hover:bg-[#e6b800]">-</button>
                            <span class="font-semibold w-8 text-center">${item.quantity}</span>
                            <button onclick="updateDineInQuantity(${index}, 1)" class="w-8 h-8 bg-[#ffcc00] text-[#3e2723] rounded-full flex items-center justify-center hover:bg-[#e6b800]">+</button>
                            <button onclick="removeFromDineIn(${index})" class="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 mr-2"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateCartQuantity(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                removeFromCart(index);
            } else {
                renderCartItems();
            }
        }

        function updateDineInQuantity(index, change) {
            dineInCart[index].quantity += change;
            if (dineInCart[index].quantity <= 0) {
                removeFromDineIn(index);
            } else {
                renderDineInItems();
            }
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCartItems();
        }

        function removeFromDineIn(index) {
            dineInCart.splice(index, 1);
            renderDineInItems();
        }

        function clearCart() {
            cart = [];
            renderCartItems();
            toggleCartModal();
            showToast('تم إفراغ السلة');
        }

        // --- SIZE MODAL ---
        function openSizeModal(productId) {
            selectedProductForSize = restaurantData.products.find(p => p.id === productId);
            selectedSize = null;
            
            const modal = document.getElementById('size-modal');
            document.getElementById('size-modal-image').src = selectedProductForSize.image;
            document.getElementById('size-modal-title').textContent = selectedProductForSize.name;
            
            const optionsContainer = document.getElementById('size-options');
            if (selectedProductForSize.hasSizes) {
                optionsContainer.innerHTML = selectedProductForSize.sizes.map((size, index) => `
                    <label class="flex items-center justify-between p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                        <span class="font-medium">${size.name}</span>
                        <span class="font-bold text-[#d97634]">${size.price} ج.م</span>
                        <input type="radio" name="size" value="${index}" onchange="selectSize(${index})" class="mr-2">
                    </label>
                `).join('');
            } else {
                optionsContainer.innerHTML = `
                    <div class="text-center font-bold text-lg text-[#d97634]">
                        ${selectedProductForSize.price} ج.م
                    </div>
                `;
                selectSize(null); // No size needed
            }
            
            modal.style.display = 'flex';
        }

        function openSizeModalForDineIn(productId) {
            openSizeModal(productId);
            // Swap button actions for dine-in context
            document.getElementById('add-to-cart-size').style.display = 'none';
            document.getElementById('add-to-dinein-size').style.display = 'block';
        }

        function selectSize(index) {
            selectedSize = index !== null ? restaurantData.products.find(p => p.id === selectedProductForSize.id).sizes[index] : null;
            document.getElementById('add-to-cart-size').disabled = false;
            document.getElementById('add-to-dinein-size').disabled = false;
        }

        function addToCartWithSize() {
            const price = selectedSize ? selectedSize.price : selectedProductForSize.price;
            const existingItem = cart.find(item => item.id === selectedProductForSize.id && item.sizeName === (selectedSize ? selectedSize.name : null));
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    ...selectedProductForSize,
                    price: price,
                    sizeName: selectedSize ? selectedSize.name : null,
                    quantity: 1
                });
            }
            
            toggleSizeModal();
            renderCartItems();
            showToast('تمت الإضافة إلى سلة التوصيل');
        }

        function addToDineInWithSize() {
            const price = selectedSize ? selectedSize.price : selectedProductForSize.price;
            const existingItem = dineInCart.find(item => item.id === selectedProductForSize.id && item.sizeName === (selectedSize ? selectedSize.name : null));
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                dineInCart.push({
                    ...selectedProductForSize,
                    price: price,
                    sizeName: selectedSize ? selectedSize.name : null,
                    quantity: 1
                });
            }
            
            toggleSizeModal();
            renderDineInItems();
            showToast('تمت الإضافة إلى طلب المطعم');
        }

        function toggleSizeModal() {
            const modal = document.getElementById('size-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            document.getElementById('add-to-cart-size').style.display = 'block';
            document.getElementById('add-to-dinein-size').style.display = 'none';
        }

        // --- CUSTOMER INFO & ORDER SUBMISSION ---
        function openCustomerInfoModal() {
            toggleCustomerInfoModal();
        }

        function toggleCustomerInfoModal() {
            const modal = document.getElementById('customer-info-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function validateAndSendOrder() {
            // All previous validation logic has been removed.
            // The function now proceeds directly to sending the order.
            sendOrderToWhatsApp();
        }

        function sendOrderToWhatsApp() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const city = document.getElementById('city').value;
            const district = document.getElementById('district').value;
            const street = document.getElementById('street').value;
            const buildingNumber = document.getElementById('buildingNumber').value;
            const apartmentNumber = document.getElementById('apartmentNumber').value;
            const floorNumber = document.getElementById('floorNumber').value;
            const locationNotes = document.getElementById('locationNotes').value;
            const orderNotes = document.getElementById('orderNotes').value;
            const locationUrl = document.getElementById('locationUrl').value;

            let orderDetails = `🛒 *طلب جديد من قصر السمين*\n\n`;
            orderDetails += `📋 *تفاصيل الطلب:*\n`;
            cart.forEach(item => {
                orderDetails += `- ${item.quantity}x ${item.name} ${item.sizeName ? `(${item.sizeName})` : ''} - ${item.price * item.quantity} ج.م\n`;
            });
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            orderDetails += `\n💰 *الإجمالي:* ${total} ج.م\n\n`;

            orderDetails += `👤 *معلومات العميل:*\n`;
            if (customerName) orderDetails += `- الاسم: ${customerName}\n`;
            if (customerPhone) orderDetails += `- الهاتف: ${customerPhone}\n`;
            
            orderDetails += `\n📍 *عنوان التوصيل:*\n`;
            if (city) orderDetails += `- المدينة: ${city}\n`;
            if (district) orderDetails += `- المنطقة: ${district}\n`;
            if (street) orderDetails += `- الشارع: ${street}\n`;
            if (buildingNumber) orderDetails += `- رقم المبنى: ${buildingNumber}\n`;
            if (apartmentNumber) orderDetails += `- رقم الشقة: ${apartmentNumber}\n`;
            if (floorNumber) orderDetails += `- الطابق: ${floorNumber}\n`;
            if (locationNotes) orderDetails += `- علامة مميزة: ${locationNotes}\n`;
            if (locationUrl) orderDetails += `- رابط الموقع: ${locationUrl}\n`;

            if (orderNotes) {
                orderDetails += `\n📝 *ملاحظات إضافية:*\n${orderNotes}\n`;
            }

            const whatsappUrl = `https://wa.me/201030566078?text=${encodeURIComponent(orderDetails)}`;
            window.open(whatsappUrl, '_blank');

            // Clear cart and close modals after sending
            cart = [];
            toggleCustomerInfoModal();
            toggleCartModal();
            
            // MODIFICATION: Added a second toast message
            showToast('تم إرسال طلبك بنجاح!');
            setTimeout(() => {
                showToast('جاري مراجعة طلبك وسيتم تنفيذه قريباً');
            }, 2500);
        }

        function sendDineInToWhatsApp() {
            const customerName = document.getElementById('dineInCustomerName').value;
            const tableNumber = document.getElementById('tableNumber').value;
            const orderNotes = document.getElementById('dineInOrderNotes').value;

            let orderDetails = `🍽️ *طلب جديد داخل المطعم - قصر السمين*\n\n`;
            orderDetails += `📋 *تفاصيل الطلب:*\n`;
            dineInCart.forEach(item => {
                orderDetails += `- ${item.quantity}x ${item.name} ${item.sizeName ? `(${item.sizeName})` : ''} - ${item.price * item.quantity} ج.م\n`;
            });
            const total = dineInCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            orderDetails += `\n💰 *الإجمالي:* ${total} ج.م\n\n`;

            orderDetails += `👤 *معلومات العميل:*\n`;
            if (customerName) orderDetails += `- الاسم: ${customerName}\n`;
            if (tableNumber) orderDetails += `- رقم الترابيزة: ${tableNumber}\n`;
            if (orderNotes) {
                orderDetails += `\n📝 *ملاحظات إضافية:*\n${orderNotes}\n`;
            }

            const whatsappUrl = `https://wa.me/201030566078?text=${encodeURIComponent(orderDetails)}`;
            window.open(whatsappUrl, '_blank');

            // Clear cart and close modal after sending
            dineInCart = [];
            toggleDineInModal();
            
            // MODIFICATION: Added a second toast message
            showToast('تم إرسال طلبك بنجاح!');
            setTimeout(() => {
                showToast('جاري مراجعة طلبك وسيتم تنفيذه قريباً');
            }, 2500);
        }

        // --- LOCATION ---
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                showToast("الموقع الجغرافي غير مدعوم في هذا المتصفح.");
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            document.getElementById('latitude').value = lat;
            document.getElementById('longitude').value = lon;
            const locationUrl = `https://www.google.com/maps?q=${lat},${lon}`;
            document.getElementById('locationUrl').value = locationUrl;
            
            const mapPlaceholder = document.getElementById('map-placeholder');
            mapPlaceholder.innerHTML = `
                <iframe 
                    width="100%" 
                    height="100%" 
                    frameborder="0" 
                    style="border:0" 
                    src="https://www.google.com/maps?q=${lat},${lon}&output=embed"
                    allowfullscreen>
                </iframe>
            `;
            showToast('تم تحديد موقعك بنجاح!');
        }

        function showError(error) {
            let message = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = "تم رفض طلب الموقع من قبل المستخدم.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = "معلومات الموقع غير متاحة.";
                    break;
                case error.TIMEOUT:
                    message = "انتهت مهلة طلب الموقع.";
                    break;
                case error.UNKNOWN_ERROR:
                    message = "حدث خطأ غير معروف.";
                    break;
            }
            showToast(message);
        }

        // --- UTILITIES ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function scrollToMenu() {
            document.getElementById('menu-section').scrollIntoView({ behavior: 'smooth' });
        }

        function scrollToCategory(categoryId) {
            document.getElementById(`category-${categoryId}`).scrollIntoView({ behavior: 'smooth' });
        }

        function openMap() {
            // Placeholder for map opening logic
            showToast('سيتم فتح الخريطة قريبًا');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.onscroll = function() {
            const scrollToTopBtn = document.getElementById('scroll-to-top');
            if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                scrollToTopBtn.style.display = "flex";
            } else {
                scrollToTopBtn.style.display = "none";
            }
        };

        // --- MODAL BACKGROUND CLICK HANDLERS ---
        function closeCartModalOnBackground(event) {
            if (event.target.id === 'cart-modal') {
                toggleCartModal();
            }
        }

        function closeDineInModalOnBackground(event) {
            if (event.target.id === 'dinein-modal') {
                toggleDineInModal();
            }
        }

        function closeCustomerInfoModalOnBackground(event) {
            if (event.target.id === 'customer-info-modal') {
                toggleCustomerInfoModal();
            }
        }

        function closeSizeModalOnBackground(event) {
            if (event.target.id === 'size-modal') {
                toggleSizeModal();
            }
        }
    </script>
</body>
</html>
